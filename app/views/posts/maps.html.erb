<div id="map"></div>


<script>
    var map;
    var pos = {lat: 42.7451063, lng:15.436844};
    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: pos,
            zoom: 5,
        });

        var m = [
            getMarker(42.9814949, 13.0298647, 'Italia'),
            getMarker(46.2999454, 1.7153401, 'Francia')
        ];

        function getMarker(lat, lng, title){
            var marker = new google.maps.Marker({
            position : {lat: lat, lng: lng},
            map: map,
            title: title
            });

            marker.addListener('click', function() {
              var title = marker.get('title');
              // Esegui la chiamata AJAX al server per recuperare i post
              $.ajax({
                url: '/maps/' + title,
                type: 'GET',
                success: function(response) {
                  $("#markerModalLabel").text(title);
                  $('#markerModal').modal('show');
                  var postsHtml = '';
                  response.forEach(function(post) {
                    postsHtml += '<div class="post">';
                    postsHtml += '<h3 class="post-title">' + post.title + '</h3>';
                    postsHtml += '<p class="post-body">' + post.body + '</p>';
                    postsHtml += '<img class="post-img" src=' + post.img_test + ' style="width: 20%; border-radius: 5px;" >';
                    postsHtml += '</div>';
                  });
                  $('#markerModal .modal-body').html(postsHtml);
                },

                error: function() {
                  alert('Errore durante il caricamento dei post.');
                }
              });
            });

        }
    }

</script>

<style>

#map {
  height: 500px;
}

/* 
 * Optional: Makes the sample page fill the window. 
 */
html,
body {
  height: 100%;
  margin: 0;
  padding: 0;
}

</style>


<!-- Modal -->
<div class="modal fade" id="markerModal" tabindex="-1" role="dialog" aria-labelledby="markerModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="width:600px;">
      <div class="modal-header">
        <h5 class="modal-title" id="markerModalLabel">Titolo del marker</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Chiudi</button>
      </div>
    </div>
  </div>
</div>
